# Docusaurus OpenAPI Integration Guide

## âœ… Successfully Integrated!

Aicser documentation now features **interactive API reference** powered by [docusaurus-openapi-docs](https://docusaurus-openapi.tryingpan.dev/).

## ğŸ¯ What's New

### Interactive API Documentation
- **Auto-generated** from OpenAPI specification
- **"Try it out"** functionality for testing endpoints directly
- **Schema documentation** with type definitions
- **Authentication support** with token persistence
- **Clean, professional UI** matching your existing docs

### Key Features
- âœ… Upgraded Docusaurus from 3.1.1 to 3.8.1
- âœ… Integrated docusaurus-openapi-docs v4.0.2
- âœ… API Reference in navbar
- âœ… Organized sidebar structure
- âœ… Sample OpenAPI spec included
- âœ… Docker support (Node 20)

## ğŸ“ Project Structure

```
src/docs/reference/
â”œâ”€â”€ api/                           # Auto-generated API docs
â”‚   â”œâ”€â”€ sidebar.ts                 # Auto-generated sidebar
â”‚   â”œâ”€â”€ aicser-platform-api.info.mdx
â”‚   â”œâ”€â”€ authentication.tag.mdx     # Authentication endpoints
â”‚   â”œâ”€â”€ analytics.tag.mdx          # Analytics endpoints
â”‚   â”œâ”€â”€ ai-analysis.tag.mdx        # AI Analysis endpoints
â”‚   â”œâ”€â”€ login.api.mdx
â”‚   â”œâ”€â”€ generate-chart.api.mdx
â”‚   â”œâ”€â”€ ai-analyze.api.mdx
â”‚   â””â”€â”€ schemas/                   # Schema definitions
â”‚       â”œâ”€â”€ loginrequest.schema.mdx
â”‚       â”œâ”€â”€ tokenresponse.schema.mdx
â”‚       â”œâ”€â”€ chartgenerationrequest.schema.mdx
â”‚       â””â”€â”€ ...
â””â”€â”€ api-reference.md               # API Overview (original content preserved)

static/
â””â”€â”€ openapi.json                   # OpenAPI specification source
```

## ğŸš€ Usage

### 1. Update OpenAPI Spec from FastAPI

When your FastAPI backend is running at `localhost:8000`:

```bash
# Fetch latest OpenAPI spec from FastAPI
npm run fetch-openapi

# Or with custom backend URL
BACKEND_URL=http://localhost:8000/docs/json npm run fetch-openapi
```

### 2. Regenerate API Documentation

After updating the OpenAPI spec:

```bash
# Clean old generated docs
npm run clean-api-docs

# Generate new docs
npm run gen-api-docs

# Or do both at once
npm run gen-api-docs-local
```

### 3. Using Docker Compose

```bash
# Rebuild container with new dependencies
docker-compose -f docker-compose.docs.yml build --no-cache docs-dev

# Fetch OpenAPI spec (when backend is running)
npm run fetch-openapi

# Generate API docs in container
docker-compose -f docker-compose.docs.yml run --rm docs-dev sh -c "npm install && npx docusaurus gen-api-docs aicser"

# Start development server
docker-compose -f docker-compose.docs.yml up docs-dev
```

Visit: http://localhost:3006

## ğŸ“ Configuration

### docusaurus.config.js

```javascript
plugins: [
  [
    'docusaurus-plugin-openapi-docs',
    {
      id: 'api',
      docsPluginId: 'classic',
      config: {
        aicser: {
          specPath: 'static/openapi.json',      // OpenAPI spec location
          outputDir: 'src/docs/reference/api',  // Output directory
          sidebarOptions: {
            groupPathsBy: 'tag',                // Group by tags
            categoryLinkSource: 'tag',
          },
          downloadUrl: '/openapi.json',         // Allow spec download
          hideSendButton: false,                // Enable "Try it out"
          showSchemas: true,                    // Show schema docs
        },
      },
    },
  ],
],

themes: ['docusaurus-theme-openapi-docs'],

themeConfig: {
  api: {
    authPersistance: 'localStorage',  // Persist auth tokens
    requestTimeout: 30000,            // 30 second timeout
  },
  // ... rest of config
}
```

### sidebars-reference.js

```javascript
const sidebars = {
  reference: [
    {
      type: 'doc',
      id: 'reference/api-reference',  // Original API overview
      label: 'API Overview',
    },
    {
      type: 'category',
      label: 'API Reference',         // Generated docs section
      items: [
        {
          type: 'autogenerated',
          dirName: 'reference/api',   // Auto-generated docs
        },
      ],
    },
  ],
};
```

## ğŸ”§ Customization

### Enhance Your OpenAPI Spec

For better documentation, add these to your FastAPI OpenAPI spec:

#### 1. **Tags and Tag Groups**

```python
# In your FastAPI app
app = FastAPI(
    title="Aicser Platform API",
    version="1.0.0",
    openapi_tags=[
        {
            "name": "Authentication",
            "description": "User authentication and authorization"
        },
        {
            "name": "Analytics",
            "description": "Chart generation and analytics"
        },
        {
            "name": "AI Analysis",
            "description": "AI-powered insights"
        },
    ]
)
```

#### 2. **Code Examples** (x-codeSamples)

```python
@router.post(
    "/login",
    response_model=TokenResponse,
    openapi_extra={
        "x-codeSamples": [
            {
                "lang": "curl",
                "source": """curl -X POST "http://localhost:8000/api/v1/auth/login" \\
  -H "Content-Type: application/json" \\
  -d '{"email": "user@example.com", "password": "password"}'"""
            },
            {
                "lang": "python",
                "source": """import requests

response = requests.post(
    "http://localhost:8000/api/v1/auth/login",
    json={"email": "user@example.com", "password": "password"}
)
tokens = response.json()"""
            },
            {
                "lang": "javascript",
                "source": """const response = await fetch('http://localhost:8000/api/v1/auth/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    email: 'user@example.com',
    password: 'password'
  })
});
const tokens = await response.json();"""
            }
        ]
    }
)
async def login(credentials: LoginRequest):
    # ...
```

#### 3. **Better Descriptions**

```python
@router.post(
    "/charts/generate",
    summary="Generate Chart from Natural Language",
    description="""
    Generate a chart from a natural language query and your data.
    
    The AI will:
    - Analyze your query and data structure
    - Determine the best chart type
    - Generate an ECharts configuration
    - Provide insights about your data
    
    **Example queries:**
    - "Show me sales trends by month"
    - "Compare revenue across regions"
    - "Display customer growth over time"
    """,
    response_model=ChartResponse
)
```

### Customize Styling

Edit `src/css/custom.css`:

```css
/* Customize API doc styling */
:root {
  --openapi-card-background-color: var(--ifm-card-background-color);
  --openapi-code-background-color: var(--ifm-code-background);
}

/* Customize request/response sections */
.openapi-tabs__request {
  border-radius: 8px;
}

/* Style operation cards */
.openapi-operation {
  margin-bottom: 2rem;
}
```

## ğŸ”„ Workflow

### Development Workflow

1. **Develop FastAPI backend** with proper OpenAPI annotations
2. **Fetch OpenAPI spec**: `npm run fetch-openapi`
3. **Generate docs**: `npm run gen-api-docs`
4. **Preview**: `npm start` (port 3005)
5. **Commit generated docs** to repository

### Production Deployment

```bash
# 1. Fetch latest spec from production API
BACKEND_URL=https://api.aicser.com/docs/json npm run fetch-openapi

# 2. Regenerate docs
npm run gen-api-docs-local

# 3. Build production site
npm run build

# 4. Deploy
npm run deploy
```

### CI/CD Integration

Add to your GitHub Actions workflow:

```yaml
- name: Fetch OpenAPI Spec
  run: |
    BACKEND_URL=${{ secrets.API_URL }}/docs/json npm run fetch-openapi

- name: Generate API Docs
  run: npm run gen-api-docs

- name: Build Documentation
  run: npm run build
```

## ğŸ“š Available Scripts

| Script | Description |
|--------|-------------|
| `npm run fetch-openapi` | Fetch OpenAPI spec from FastAPI backend |
| `npm run gen-api-docs` | Generate API docs from OpenAPI spec |
| `npm run gen-api-docs-local` | Fetch spec + generate docs |
| `npm run clean-api-docs` | Clean generated API docs |
| `npm start` | Start development server (port 3005) |
| `npm run build` | Build production site |

## ğŸ¨ Benefits

### For Developers
- âœ… **Interactive testing** right from docs
- âœ… **Always up-to-date** with actual API
- âœ… **Type definitions** and schemas
- âœ… **Code examples** in multiple languages
- âœ… **Authentication flow** testing

### For Documentation Maintainers
- âœ… **Zero manual maintenance** for API endpoints
- âœ… **Single source of truth** (OpenAPI spec)
- âœ… **Automatic synchronization** with backend
- âœ… **Professional UI** out of the box
- âœ… **Consistent styling** with existing docs

### For End Users
- âœ… **Clean, intuitive interface**
- âœ… **Try endpoints** without external tools
- âœ… **Clear request/response examples**
- âœ… **Schema documentation**
- âœ… **Dark mode support**

## ğŸ”— Resources

- [Docusaurus OpenAPI Docs](https://docusaurus-openapi.tryingpan.dev/)
- [Configuration Reference](https://docusaurus-openapi.tryingpan.dev/configuration)
- [CLI Commands](https://docusaurus-openapi.tryingpan.dev/cli)
- [GitHub Repository](https://github.com/PaloAltoNetworks/docusaurus-openapi-docs)

## ğŸ› Troubleshooting

### Can't connect to localhost:8000
- Ensure FastAPI backend is running
- Use `npm run fetch-openapi` to download spec first
- Update `specPath` in config to use static file

### Generated docs look wrong
- Validate OpenAPI spec at https://validator.swagger.io/
- Check console for errors
- Ensure all tags are defined in spec

### Docker build fails
- Ensure Node 20 is used (updated in Dockerfiles)
- Clear Docker cache: `docker-compose build --no-cache`
- Check volume mounts in docker-compose.yml

### "Try it out" doesn't work
- Check CORS configuration on backend
- Consider using proxy: `api: { proxy: "https://cors.pan.dev" }`
- Verify authentication tokens

## ğŸ“ Support

For issues or questions:
- ğŸ“§ Email: support@aicser.com
- ğŸ’¬ Telegram: https://t.me/+XyM6Y-8MnWU2NTM1
- ğŸ› GitHub Issues: https://github.com/aiser-platform/aiser-world

---

**Note**: The sample OpenAPI spec in `static/openapi.json` is a template. Replace it with your actual FastAPI spec using `npm run fetch-openapi` when your backend is ready.
